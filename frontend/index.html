<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FC-CRM System - ダッシュボード</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <!-- ナビゲーションバー -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="index.html">
                <i class="bi bi-envelope-check"></i> FC-CRM System
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="index.html">
                            <i class="bi bi-speedometer2"></i> ダッシュボード
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="companies.html">
                            <i class="bi bi-building"></i> 企業管理
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="send.html">
                            <i class="bi bi-send"></i> 送信管理
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="ng-list.html">
                            <i class="bi bi-shield-x"></i> NGリスト
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="logs.html">
                            <i class="bi bi-file-text"></i> ログ閲覧
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="settings.html">
                            <i class="bi bi-gear"></i> 設定
                        </a>
                    </li>
                </ul>
                <span class="navbar-text">
                    <i class="bi bi-person-circle"></i> 管理者
                </span>
            </div>
        </div>
    </nav>

    <!-- メインコンテンツ -->
    <div class="container-fluid mt-4">
        <!-- 概要カード -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="card-title">登録企業数</h6>
                                <h3 class="mb-0" id="total-companies">-</h3>
                            </div>
                            <div class="align-self-center">
                                <i class="bi bi-building fs-1"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <small>アクティブ企業のみ</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="card-title">今日の送信数</h6>
                                <h3 class="mb-0" id="today-sends">-</h3>
                            </div>
                            <div class="align-self-center">
                                <i class="bi bi-send fs-1"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <small>本日の実績</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-warning text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="card-title">成功率</h6>
                                <h3 class="mb-0" id="success-rate">-%</h3>
                            </div>
                            <div class="align-self-center">
                                <i class="bi bi-graph-up fs-1"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <small>今月の実績</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="card-title">ChatGPT使用</h6>
                                <h3 class="mb-0" id="chatgpt-usage">-</h3>
                            </div>
                            <div class="align-self-center">
                                <i class="bi bi-robot fs-1"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <small>今月のトークン数</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- 送信スケジュール -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-calendar-check"></i> 今日の送信スケジュール
                        </h5>
                        <button class="btn btn-primary btn-sm" onclick="refreshSchedule()">
                            <i class="bi bi-arrow-clockwise"></i> 更新
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="schedule-list">
                            <div class="text-center text-muted">
                                <i class="bi bi-hourglass-split"></i>
                                <p>読み込み中...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 最近の送信履歴 -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-clock-history"></i> 最近の送信履歴
                        </h5>
                        <a href="logs.html" class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-eye"></i> 全て見る
                        </a>
                    </div>
                    <div class="card-body">
                        <div id="recent-history">
                            <div class="text-center text-muted">
                                <i class="bi bi-hourglass-split"></i>
                                <p>読み込み中...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- システム状態 -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-activity"></i> システム状態
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="badge bg-success me-2" id="db-status">●</span>
                                    <span>データベース</span>
                                    <span class="ms-auto text-muted" id="db-status-text">確認中...</span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="badge bg-success me-2" id="api-status">●</span>
                                    <span>API サーバー</span>
                                    <span class="ms-auto text-muted" id="api-status-text">確認中...</span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="badge bg-warning me-2" id="chatgpt-status">●</span>
                                    <span>ChatGPT API</span>
                                    <span class="ms-auto text-muted" id="chatgpt-status-text">未設定</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- アプリケーション JS -->
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/mock-data.js"></script>
    <script src="js/app.js"></script>

    <script>
        // ページ読み込み時の初期化
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            checkSystemHealth();

            // 30秒ごとにシステム状態をチェック
            setInterval(checkSystemHealth, 30000);
        });
    </script>
</body>
</html>